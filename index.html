<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Quiz Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 600px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .content {
            padding: 30px 20px;
        }

        /* Sections */
        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* Setup Section */
        .setup-section {
            text-align: center;
        }

        .api-key-input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-family: monospace;
        }

        .api-key-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .api-help {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: left;
            font-size: 13px;
            line-height: 1.6;
        }

        .api-help a {
            color: #667eea;
            text-decoration: none;
        }

        .api-help a:hover {
            text-decoration: underline;
        }

        /* Course Selection */
        .course-selection {
            margin-bottom: 20px;
        }

        .course-selection label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .course-selection select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 15px;
            cursor: pointer;
        }

        .course-selection select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .question-count {
            margin-bottom: 20px;
        }

        .question-count label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
        }

        .question-count input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }

        .question-count input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* Quiz Section */
        .quiz-section {
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .progress-bar {
            background: #e0e0e0;
            height: 4px;
            border-radius: 2px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            transition: width 0.3s ease;
        }

        .question-number {
            font-size: 13px;
            color: #999;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .question-text {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
            line-height: 1.5;
        }

        .options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        .option-button {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            text-align: center;
            font-size: 14px;
            transition: all 0.2s ease;
            position: relative;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .option-button:hover:not(:disabled) {
            border-color: #667eea;
            background: #f9f9ff;
        }

        .option-button:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .option-button.correct {
            border-color: #4caf50;
            background: #e8f5e9;
            color: #2e7d32;
            font-weight: 600;
        }

        .option-button.incorrect {
            border-color: #f44336;
            background: #ffebee;
            color: #c62828;
        }

        .explanation {
            background: #f0f4ff;
            border-left: 4px solid #667eea;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            font-size: 14px;
            line-height: 1.6;
        }

        .explanation-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .explanation-content {
            color: #555;
        }

        .explanation-content ol {
            margin-left: 20px;
            margin-top: 8px;
        }

        .explanation-content li {
            margin-bottom: 6px;
        }

        /* Results Section */
        .results-section {
            text-align: center;
        }

        .score-display {
            font-size: 48px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .results-details {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            line-height: 1.8;
        }

        /* Buttons */
        .button {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .button-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .button-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .button-primary:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        .button-secondary {
            background: #f5f5f5;
            color: #333;
            border: 2px solid #e0e0e0;
        }

        .button-secondary:hover {
            background: #efefef;
            border-color: #667eea;
        }

        .button-danger {
            background: #ff6b6b;
            color: white;
            font-size: 13px;
        }

        .button-danger:hover {
            background: #ff5252;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö Study Quiz Generator</h1>
            <p>Master your courses with AI-powered quizzes</p>
        </div>

        <div class="content">
            <!-- Setup Section -->
            <div class="section setup-section active" id="setupSection">
                <h2 style="margin-bottom: 20px; font-size: 20px;">Get Started</h2>
                <div class="api-help">
                    <strong>Step 1: Get your API key</strong><br>
                    1. Go to <a href="https://console.anthropic.com" target="_blank">console.anthropic.com</a><br>
                    2. Click "API Keys" in the left menu<br>
                    3. Click "Create Key"<br>
                    4. Copy the key and paste it below
                </div>
                <input type="password" id="apiKey" class="api-key-input" placeholder="Paste your Anthropic API key here...">
                <button class="button button-primary" onclick="setupApiKey()">Continue</button>
            </div>

            <!-- Course Selection Section -->
            <div class="section" id="courseSection">
                <h2 style="margin-bottom: 20px; font-size: 20px;">Select Your Course</h2>
                <div class="course-selection">
                    <label for="courseSelect">Choose a course:</label>
                    <select id="courseSelect"></select>
                </div>
                <div class="question-count">
                    <label for="numQuestions">Number of questions (1-20):</label>
                    <input type="number" id="numQuestions" value="5" min="1" max="20">
                </div>
                <button class="button button-primary" id="generateBtn" onclick="generateQuestions()">Generate Questions</button>
                <button class="button button-secondary" onclick="logout()">Change API Key</button>
            </div>

            <!-- Quiz Section -->
            <div class="section quiz-section" id="quizSection">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="question-number" id="questionNumber"></div>
                <div class="question-text" id="questionText"></div>
                <div class="options" id="optionsContainer"></div>
                <div id="explanationContainer"></div>
            </div>

            <!-- Results Section -->
            <div class="section results-section" id="resultsSection">
                <h2 style="margin-bottom: 15px;">Quiz Complete!</h2>
                <div class="score-display" id="scoreDisplay">0</div>
                <div style="font-size: 14px; margin-bottom: 20px;">out of <span id="totalQuestions">0</span></div>
                <div class="results-details" id="resultsDetails"></div>
                <button class="button button-primary" onclick="goToCourseSelection()">Take Another Quiz</button>
                <button class="button button-danger" onclick="logout()">Logout</button>
            </div>
        </div>
    </div>

    <script>
        // ===== COURSES DATA =====
        const courses = {
            'java': {
                name: 'Intro to Java (COMS 1004)',
                material: `
                    FLOWCHARTS AND ALGORITHMS:
                    Flowcharts represent algorithms using visual blocks. "Set" instructions assign values to variables. Diamond shapes represent decisions/conditions. Variables can be updated multiple times during execution. Index starts at 0 for lists/arrays.
                    
                    TRACING ALGORITHMS:
                    Follow each instruction step-by-step. Update variable values each time a "Set" is executed. Track how values change through loops and conditions. Important to record initial and final values.
                    
                    BINARY SEARCH ALGORITHM:
                    Works on SORTED lists only. Initialize LOW = 0, HIGH = last index. Calculate MID = (LOW + HIGH) / 2, round down. If target found at MID, return MID. If target is less than LIST[MID], set HIGH = MID - 1 (search left). If target is greater than LIST[MID], set LOW = MID + 1 (search right). Stop when LOW > HIGH, return -1 if not found. Much faster than linear search.
                    
                    BUBBLE SORT ALGORITHM:
                    Sorts list by comparing adjacent pairs. Swap if pair is out of order (left > right). After each pass, largest element "bubbles" to end. Continue passes until no swaps occur (list is sorted). Can sort numbers or strings in alphabetical order.
                    
                    SELECTION SORT ALGORITHM:
                    Find smallest element in remaining list. Swap it with element at current position. Move to next position and repeat. More efficient than bubble sort. Works on any orderable data type.
                    
                    COUNTING ALGORITHM:
                    Count occurrences of a target value. Loop through list, check each element. Increment counter when target is found. Output is the number of matches in the list.
                    
                    FINDING MINIMUM:
                    Track smallest value and its index. Compare each element to current minimum. Update minimum when a smaller value is found. Output can be the value itself or its index position.
                    
                    DIVISION ALGORITHM (Integer Division):
                    Count how many times divisor goes into dividend. Subtract divisor repeatedly from dividend. Count each subtraction. Output is quotient with no remainder. For example, 8 divided by 3 equals 2.
                `
            },
            'calculus1': {
                name: 'Calculus I',
                material: `
                    LIMITS AND CONTINUITY:
                    - The concept of limit: lim(x‚Üía) f(x) = L means you can make f(x) as close as you want to L by choosing x close enough to (but not equal to) a
                    - A limit can exist even if f(a) is not defined or if f(a) does not equal the limit
                    - Average rate of change is found by taking a quotient (slope of secant line)
                    - Instantaneous rate of change at a point requires finding the limit of slopes of secant lines over shorter and shorter intervals
                    - The slope of the tangent line at x = a is the limit of slopes of secant lines as the interval shrinks
                    - Infinite limits: lim(x‚Üía) f(x) = ‚àû means you can make f(x) as large as you want by choosing x close enough to a
                    - One-sided limits: lim(x‚Üía+) f(x) restricts attention to x > a, and lim(x‚Üía-) f(x) restricts to x < a
                    - If f has an infinite limit at x = a, then f has a vertical asymptote at x = a
                    - Important limit: lim(x‚Üí0) sin(x)/x = 1
                    
                    INVERSE FUNCTIONS AND LOGARITHMS:
                    - A function is one-to-one if different inputs give different outputs (must be increasing or decreasing on its domain)
                    - For a one-to-one function, the inverse function f‚Åª¬π is defined such that f(f‚Åª¬π(x)) = x
                    - The natural exponential function e^x is the inverse of the natural logarithm ln(x)
                    - The natural logarithm ln(x) is the inverse of e^x
                    - Change of base formula: loga(x) = ln(x)/ln(a)
                    
                    FUNCTION COMBINATIONS AND COMPOSITION:
                    - Sum: (f + g)(x) = f(x) + g(x)
                    - Difference: (f - g)(x) = f(x) - g(x)
                    - Product: (f¬∑g)(x) = f(x)¬∑g(x)
                    - Quotient: (f/g)(x) = f(x)/g(x) if g(x) ‚â† 0
                    - Composition: (f ‚àò g)(x) = f(g(x)), read as "f circle g"
                    - The domain of a composition is restricted to where g is defined and where f(g(x)) is defined
                    
                    EXPONENTIAL AND LOGARITHMIC FUNCTIONS:
                    - Exponential functions f(x) = a^x are defined for all real x (where a > 0)
                    - Exponentiation rules: a^(x+y) = a^x¬∑a^y, a^(x-y) = a^x/a^y, (a^x)^y = a^(xy), (ab)^x = a^x¬∑b^x
                    - For f(x) = a^x: f(x+k) = a^(x+k) = a^x¬∑a^k = a^k¬∑f(x)
                    - If x is increased by k, then f(x) is multiplied by constant C = a^k
                    - Exponential growth occurs when a > 1 (C > 1)
                    - Exponential decay occurs when 0 < a < 1 (C < 1)
                    - Exponential functions model bacteria growth, radioactive decay, and other real-world processes
                    - For rational powers p/q: a^(p/q) = (q-th root of a) raised to the p-th power
                    - Irrational exponents are defined by approximating with rational numbers
                    
                    TRIGONOMETRIC FUNCTIONS:
                    - Angles are measured in radians
                    - sin(x) is an odd function: sin(-x) = -sin(x)
                    - cos(x) is an even function: cos(-x) = cos(x)
                    - tan(x) = sin(x)/cos(x)
                    - sin(Œ∏) and cos(Œ∏) are defined using the unit circle
                    - Key values: sin(œÄ/4) = ‚àö2/2, cos(œÄ/4) = ‚àö2/2, sin(œÄ/6) = 1/2, cos(œÄ/6) = ‚àö3/2
                    - Inverse sine function arcsin maps [-1, 1] to [-œÄ/2, œÄ/2]
                    - Inverse tangent function arctan maps all real numbers to (-œÄ/2, œÄ/2)
                    - The domain of sin(‚àöx) is all x ‚â• 0 because x must be non-negative under the square root
                `
            }
        };

        // ===== APP STATE =====
        let apiKey = localStorage.getItem('apiKey');
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let answered = [];

        // ===== INITIALIZATION =====
        function initializeCourses() {
            const select = document.getElementById('courseSelect');
            Object.keys(courses).forEach(courseId => {
                const option = document.createElement('option');
                option.value = courseId;
                option.textContent = courses[courseId].name;
                select.appendChild(option);
            });
        }

        function setupApiKey() {
            const key = document.getElementById('apiKey').value.trim();
            if (!key) {
                alert('Please paste your API key');
                return;
            }
            localStorage.setItem('apiKey', key);
            apiKey = key;
            showSection('courseSection');
        }

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
        }

        async function generateQuestions() {
            const courseId = document.getElementById('courseSelect').value;
            const numQuestions = parseInt(document.getElementById('numQuestions').value);

            if (!courseId) {
                alert('Please select a course');
                return;
            }

            if (numQuestions < 1 || numQuestions > 20) {
                alert('Please enter between 1 and 20 questions');
                return;
            }

            const material = courses[courseId].material;
            document.getElementById('generateBtn').disabled = true;
            document.getElementById('generateBtn').textContent = 'Generating...';

            try {
                // Call the Netlify backend function instead of the API directly
                const response = await fetch('/.netlify/functions/generate-questions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        material: material,
                        numQuestions: numQuestions,
                        apiKey: apiKey
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to generate questions');
                }

                const data = await response.json();
                currentQuestions = data.questions;
                currentQuestionIndex = 0;
                score = 0;
                answered = new Array(currentQuestions.length).fill(null);

                showQuestion();
                showSection('quizSection');
            } catch (error) {
                alert('Error: ' + error.message);
                console.error(error);
            } finally {
                document.getElementById('generateBtn').disabled = false;
                document.getElementById('generateBtn').textContent = 'Generate Questions';
            }
        }

        function showQuestion() {
            if (currentQuestionIndex >= currentQuestions.length) {
                showResults();
                return;
            }

            const q = currentQuestions[currentQuestionIndex];
            const progress = ((currentQuestionIndex + 1) / currentQuestions.length) * 100;

            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('questionNumber').textContent = `Question ${currentQuestionIndex + 1} of ${currentQuestions.length}`;
            document.getElementById('questionText').textContent = q.question;

            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';

            q.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'option-button';
                button.textContent = option;
                button.onclick = () => selectAnswer(index);
                optionsContainer.appendChild(button);
            });
        }

        function selectAnswer(index) {
            const q = currentQuestions[currentQuestionIndex];
            answered[currentQuestionIndex] = index;

            const buttons = document.querySelectorAll('.option-button');
            buttons.forEach((btn, i) => {
                btn.disabled = true;
                if (i === q.correct) {
                    btn.classList.add('correct');
                } else if (i === index && i !== q.correct) {
                    btn.classList.add('incorrect');
                }
            });

            if (index === q.correct) {
                score++;
                // Show brief correct message
                const explanationDiv = document.getElementById('explanationContainer');
                explanationDiv.innerHTML = `
                    <div class="explanation">
                        <div class="explanation-title">‚úÖ Correct!</div>
                    </div>
                `;
            } else {
                // Show explanation for incorrect answer
                const explanationDiv = document.getElementById('explanationContainer');
                explanationDiv.innerHTML = `
                    <div class="explanation">
                        <div class="explanation-title">‚ùå Incorrect</div>
                        <div class="explanation-content">
                            <strong>Correct Answer:</strong> ${q.options[q.correct]}<br><br>
                            <strong>Explanation:</strong><br>
                            ${q.explanation || 'This answer tests your understanding of the course material. Review the relevant concepts to improve.'}
                        </div>
                    </div>
                `;
            }

            setTimeout(() => {
                currentQuestionIndex++;
                showQuestion();
            }, 2500);
        }

        function showResults() {
            document.getElementById('scoreDisplay').textContent = score;
            document.getElementById('totalQuestions').textContent = currentQuestions.length;

            const percentage = Math.round((score / currentQuestions.length) * 100);
            const details = `
                <strong>Score:</strong> ${score}/${currentQuestions.length}<br>
                <strong>Percentage:</strong> ${percentage}%<br>
                <strong>Performance:</strong> ${getPerformanceLabel(percentage)}
            `;
            document.getElementById('resultsDetails').innerHTML = details;

            showSection('resultsSection');
        }

        function getPerformanceLabel(percentage) {
            if (percentage >= 90) return 'üåü Outstanding!';
            if (percentage >= 80) return '‚úÖ Great job!';
            if (percentage >= 70) return 'üëç Good work!';
            if (percentage >= 60) return 'üìö Keep studying!';
            return 'üí™ More practice needed!';
        }

        function goToCourseSelection() {
            document.getElementById('courseSelect').value = '';
            showSection('courseSection');
        }

        function logout() {
            localStorage.removeItem('apiKey');
            apiKey = null;
            document.getElementById('apiKey').value = '';
            showSection('setupSection');
        }

        // ===== RUN ON PAGE LOAD =====
        initializeCourses();
        if (apiKey) {
            showSection('courseSection');
        }
    </script>
</body>
</html>
html<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Quiz Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 600px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .content {
            padding: 30px 20px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .setup-section {
            text-align: center;
        }

        .api-key-input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-family: monospace;
        }

        .api-key-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .api-help {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: left;
            font-size: 13px;
            line-height: 1.6;
        }

        .api-help a {
            color: #667eea;
            text-decoration: none;
        }

        .api-help a:hover {
            text-decoration: underline;
        }

        .course-selection {
            margin-bottom: 20px;
        }

        .course-selection label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .course-selection select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 15px;
            cursor: pointer;
        }

        .course-selection select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .question-count {
            margin-bottom: 20px;
        }

        .question-count label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
        }

        .question-count input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }

        .question-count input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .quiz-section {
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .progress-bar {
            background: #e0e0e0;
            height: 4px;
            border-radius: 2px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            transition: width 0.3s ease;
        }

        .question-number {
            font-size: 13px;
            color: #999;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .question-text {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
            line-height: 1.5;
        }

        .options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        .option-button {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            text-align: center;
            font-size: 14px;
            transition: all 0.2s ease;
            position: relative;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .option-button:hover:not(:disabled) {
            border-color: #667eea;
            background: #f9f9ff;
        }

        .option-button:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .option-button.correct {
            border-color: #4caf50;
            background: #e8f5e9;
            color: #2e7d32;
            font-weight: 600;
        }

        .option-button.incorrect {
            border-color: #f44336;
            background: #ffebee;
            color: #c62828;
        }

        .explanation {
            background: #f0f4ff;
            border-left: 4px solid #667eea;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            font-size: 14px;
            line-height: 1.6;
        }

        .explanation-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .explanation-content {
            color: #555;
        }

        .results-section {
            text-align: center;
        }

        .score-display {
            font-size: 48px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .results-details {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            line-height: 1.8;
        }

        .button {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .button-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .button-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .button-primary:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        .button-secondary {
            background: #f5f5f5;
            color: #333;
            border: 2px solid #e0e0e0;
        }

        .button-secondary:hover {
            background: #efefef;
            border-color: #667eea;
        }

        .button-danger {
            background: #ff6b6b;
            color: white;
            font-size: 13px;
        }

        .button-danger:hover {
            background: #ff5252;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö Study Quiz Generator</h1>
            <p>Master your courses with AI-powered quizzes</p>
        </div>

        <div class="content">
            <div class="section setup-section active" id="setupSection">
                <h2 style="margin-bottom: 20px; font-size: 20px;">Get Started</h2>
                <div class="api-help">
                    <strong>Step 1: Get your API key</strong><br>
                    1. Go to <a href="https://console.anthropic.com" target="_blank">console.anthropic.com</a><br>
                    2. Click "API Keys" in the left menu<br>
                    3. Click "Create Key"<br>
                    4. Copy the key and paste it below
                </div>
                <input type="password" id="apiKey" class="api-key-input" placeholder="Paste your Anthropic API key here...">
                <button class="button button-primary" onclick="setupApiKey()">Continue</button>
            </div>

            <div class="section" id="courseSection">
                <h2 style="margin-bottom: 20px; font-size: 20px;">Select Your Course</h2>
                <div class="course-selection">
                    <label for="courseSelect">Choose a course:</label>
                    <select id="courseSelect"></select>
                </div>
                <div class="question-count">
                    <label for="numQuestions">Number of questions (1-20):</label>
                    <input type="number" id="numQuestions" value="5" min="1" max="20">
                </div>
                <button class="button button-primary" id="generateBtn" onclick="generateQuestions()">Generate Questions</button>
                <button class="button button-secondary" onclick="logout()">Change API Key</button>
            </div>

            <div class="section quiz-section" id="quizSection">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="question-number" id="questionNumber"></div>
                <div class="question-text" id="questionText"></div>
                <div class="options" id="optionsContainer"></div>
                <div id="explanationContainer"></div>
            </div>

            <div class="section results-section" id="resultsSection">
                <h2 style="margin-bottom: 15px;">Quiz Complete!</h2>
                <div class="score-display" id="scoreDisplay">0</div>
                <div style="font-size: 14px; margin-bottom: 20px;">out of <span id="totalQuestions">0</span></div>
                <div class="results-details" id="resultsDetails"></div>
                <button class="button button-primary" onclick="goToCourseSelection()">Take Another Quiz</button>
                <button class="button button-danger" onclick="logout()">Logout</button>
            </div>
        </div>
    </div>

    <script>
        const courses = {
            'java': {
                name: 'Intro to Java (COMS 1004)',
                material: `
                    FLOWCHARTS AND ALGORITHMS:
                    Flowcharts represent algorithms using visual blocks. "Set" instructions assign values to variables. Diamond shapes represent decisions/conditions. Variables can be updated multiple times during execution. Index starts at 0 for lists/arrays.
                    
                    TRACING ALGORITHMS:
                    Follow each instruction step-by-step. Update variable values each time a "Set" is executed. Track how values change through loops and conditions. Important to record initial and final values.
                    
                    BINARY SEARCH ALGORITHM:
                    Works on SORTED lists only. Initialize LOW = 0, HIGH = last index. Calculate MID = (LOW + HIGH) / 2, round down. If target found at MID, return MID. If target is less than LIST[MID], set HIGH = MID - 1 (search left). If target is greater than LIST[MID], set LOW = MID + 1 (search right). Stop when LOW > HIGH, return -1 if not found. Much faster than linear search.
                    
                    BUBBLE SORT ALGORITHM:
                    Sorts list by comparing adjacent pairs. Swap if pair is out of order (left > right). After each pass, largest element "bubbles" to end. Continue passes until no swaps occur (list is sorted). Can sort numbers or strings in alphabetical order.
                    
                    SELECTION SORT ALGORITHM:
                    Find smallest element in remaining list. Swap it with element at current position. Move to next position and repeat. More efficient than bubble sort. Works on any orderable data type.
                    
                    COUNTING ALGORITHM:
                    Count occurrences of a target value. Loop through list, check each element. Increment counter when target is found. Output is the number of matches in the list.
                    
                    FINDING MINIMUM:
                    Track smallest value and its index. Compare each element to current minimum. Update minimum when a smaller value is found. Output can be the value itself or its index position.
                    
                    DIVISION ALGORITHM (Integer Division):
                    Count how many times divisor goes into dividend. Subtract divisor repeatedly from dividend. Count each subtraction. Output is quotient with no remainder. For example, 8 divided by 3 equals 2.
                `
            },
            'calculus1': {
                name: 'Calculus I',
                material: `
                    LIMITS AND CONTINUITY:
                    The concept of limit: lim(x‚Üía) f(x) = L means you can make f(x) as close as you want to L by choosing x close enough to (but not equal to) a. A limit can exist even if f(a) is not defined. Infinite limits and vertical asymptotes. One-sided limits. Important limit: lim(x‚Üí0) sin(x)/x = 1.
                    
                    INVERSE FUNCTIONS AND LOGARITHMS:
                    A function is one-to-one if different inputs give different outputs. The natural exponential function e^x is the inverse of the natural logarithm ln(x). Change of base formula: loga(x) = ln(x)/ln(a).
                    
                    FUNCTION COMBINATIONS AND COMPOSITION:
                    Sum: (f + g)(x) = f(x) + g(x). Difference: (f - g)(x) = f(x) - g(x). Product: (f¬∑g)(x) = f(x)¬∑g(x). Composition: (f ‚àò g)(x) = f(g(x)).
                    
                    EXPONENTIAL AND LOGARITHMIC FUNCTIONS:
                    Exponential functions f(x) = a^x. Exponentiation rules: a^(x+y) = a^x¬∑a^y. Exponential growth when a > 1. Exponential decay when 0 < a < 1.
                    
                    TRIGONOMETRIC FUNCTIONS:
                    Angles measured in radians. sin(x) is odd, cos(x) is even. tan(x) = sin(x)/cos(x). Unit circle definitions. Key values: sin(œÄ/4) = ‚àö2/2, cos(œÄ/6) = ‚àö3/2.
                `
            }
        };

        let apiKey = localStorage.getItem('apiKey');
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let answered = [];

        function initializeCourses() {
            const select = document.getElementById('courseSelect');
            Object.keys(courses).forEach(courseId => {
                const option = document.createElement('option');
                option.value = courseId;
                option.textContent = courses[courseId].name;
                select.appendChild(option);
            });
        }

        function setupApiKey() {
            const key = document.getElementById('apiKey').value.trim();
            if (!key) {
                alert('Please paste your API key');
                return;
            }
            localStorage.setItem('apiKey', key);
            apiKey = key;
            showSection('courseSection');
        }

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
        }

        async function generateQuestions() {
            const courseId = document.getElementById('courseSelect').value;
            const numQuestions = parseInt(document.getElementById('numQuestions').value);

            if (!courseId) {
                alert('Please select a course');
                return;
            }

            if (numQuestions < 1 || numQuestions > 20) {
                alert('Please enter between 1 and 20 questions');
                return;
            }

            const material = courses[courseId].material;
            document.getElementById('generateBtn').disabled = true;
            document.getElementById('generateBtn').textContent = 'Generating...';

            try {
                const response = await fetch('/.netlify/functions/generate-questions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        material: material,
                        numQuestions: numQuestions,
                        apiKey: apiKey
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to generate questions');
                }

                const data = await response.json();
                currentQuestions = data.questions;
                currentQuestionIndex = 0;
                score = 0;
                answered = new Array(currentQuestions.length).fill(null);

                showQuestion();
                showSection('quizSection');
            } catch (error) {
                alert('Error: ' + error.message);
                console.error(error);
            } finally {
                document.getElementById('generateBtn').disabled = false;
                document.getElementById('generateBtn').textContent = 'Generate Questions';
            }
        }

        function showQuestion() {
            if (currentQuestionIndex >= currentQuestions.length) {
                showResults();
                return;
            }

            const q = currentQuestions[currentQuestionIndex];
            const progress = ((currentQuestionIndex + 1) / currentQuestions.length) * 100;

            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('questionNumber').textContent = `Question ${currentQuestionIndex + 1} of ${currentQuestions.length}`;
            document.getElementById('questionText').textContent = q.question;

            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';

            q.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'option-button';
                button.textContent = option;
                button.onclick = () => selectAnswer(index);
                optionsContainer.appendChild(button);
            });
        }

        function selectAnswer(index) {
            const q = currentQuestions[currentQuestionIndex];
            answered[currentQuestionIndex] = index;

            const buttons = document.querySelectorAll('.option-button');
            buttons.forEach((btn, i) => {
                btn.disabled = true;
                if (i === q.correct) {
                    btn.classList.add('correct');
                } else if (i === index && i !== q.correct) {
                    btn.classList.add('incorrect');
                }
            });

            if (index === q.correct) {
                score++;
                const explanationDiv = document.getElementById('explanationContainer');
                explanationDiv.innerHTML = `
                    <div class="explanation">
                        <div class="explanation-title">‚úÖ Correct!</div>
                        <button class="button button-primary" style="margin-top: 15px;" onclick="nextQuestion()">Next Question</button>
                    </div>
                `;
            } else {
                const explanationDiv = document.getElementById('explanationContainer');
                explanationDiv.innerHTML = `
                    <div class="explanation">
                        <div class="explanation-title">‚ùå Incorrect</div>
                        <div class="explanation-content">
                            <strong>Correct Answer:</strong> ${q.options[q.correct]}<br><br>
                            <strong>Explanation:</strong><br>
                            ${q.explanation || 'This answer tests your understanding of the course material. Review the relevant concepts to improve.'}
                        </div>
                        <button class="button button-primary" style="margin-top: 15px;" onclick="nextQuestion()">Next Question</button>
                    </div>
                `;
            }
        }

        function nextQuestion() {
            currentQuestionIndex++;
            document.getElementById('explanationContainer').innerHTML = '';
            showQuestion();
        }

        function showResults() {
            document.getElementById('scoreDisplay').textContent = score;
            document.getElementById('totalQuestions').textContent = currentQuestions.length;

            const percentage = Math.round((score / currentQuestions.length) * 100);
            const details = `
                <strong>Score:</strong> ${score}/${currentQuestions.length}<br>
                <strong>Percentage:</strong> ${percentage}%<br>
                <strong>Performance:</strong> ${getPerformanceLabel(percentage)}
            `;
            document.getElementById('resultsDetails').innerHTML = details;

            showSection('resultsSection');
        }

        function getPerformanceLabel(percentage) {
            if (percentage >= 90) return 'üåü Outstanding!';
            if (percentage >= 80) return '‚úÖ Great job!';
            if (percentage >= 70) return 'üëç Good work!';
            if (percentage >= 60) return 'üìö Keep studying!';
            return 'üí™ More practice needed!';
        }

        function goToCourseSelection() {
            document.getElementById('courseSelect').value = '';
            showSection('courseSection');
        }

        function logout() {
            localStorage.removeItem('apiKey');
            apiKey = null;
            document.getElementById('apiKey').value = '';
            showSection('setupSection');
        }

        initializeCourses();
        if (apiKey) {
            showSection('courseSection');
        }
    </script>
</body>
</html>
