<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Quiz Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 800px;
            width: 100%;
            padding: 40px;
        }

        h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2.5em;
            text-align: center;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .subject-selection {
            margin-bottom: 30px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            color: #333;
            font-weight: 600;
            font-size: 1.1em;
        }

        select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        select:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 20px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        .quiz-container {
            display: none;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .question-card {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .progress-bar {
            background: #e0e0e0;
            height: 8px;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            transition: width 0.3s;
        }

        .question-text {
            font-size: 1.3em;
            color: #333;
            margin-bottom: 25px;
            line-height: 1.6;
            font-weight: 500;
        }

        .answers-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .answer-option {
            padding: 20px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-size: 1em;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .answer-option:hover {
            border-color: #667eea;
            background: #f0f4ff;
            transform: translateY(-2px);
        }

        .answer-option.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .answer-option.correct {
            border-color: #4caf50;
            background: #4caf50;
            color: white;
        }

        .answer-option.incorrect {
            border-color: #f44336;
            background: #f44336;
            color: white;
        }

        .explanation {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .explanation-title {
            font-weight: 600;
            color: #856404;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .explanation-text {
            color: #856404;
            line-height: 1.6;
        }

        .next-button {
            margin-top: 20px;
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 1.5em;
            font-weight: 600;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.9em;
            color: #666;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 1.8em;
            }

            .subtitle {
                font-size: 1em;
            }

            .question-text {
                font-size: 1.1em;
            }

            .answers-grid {
                grid-template-columns: 1fr;
            }

            .answer-option {
                min-height: 60px;
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŽ“ Study Quiz</h1>
        <p class="subtitle">Free practice questions - No API key needed!</p>
        
        <div id="setupSection">
            <div class="subject-selection">
                <label for="subject">Choose Your Subject:</label>
                <select id="subject">
                    <option value="">-- Select a Subject --</option>
                    <option value="java">Introduction to Java (COMS 1004)</option>
                    <option value="calculus">Calculus I</option>
                </select>
            </div>
            
            <div class="subject-selection">
                <label for="questionLimit">Number of Questions:</label>
                <select id="questionLimit">
                    <option value="5">5 Questions (Quick Practice)</option>
                    <option value="10">10 Questions (Short Session)</option>
                    <option value="15">15 Questions (Medium Session)</option>
                    <option value="20">20 Questions (Long Session)</option>
                    <option value="unlimited">Unlimited (All Questions)</option>
                </select>
            </div>
            
            <button onclick="startQuiz()">Start Quiz</button>
            
            <div style="margin-top: 30px; padding-top: 30px; border-top: 2px solid #e0e0e0;">
                <label style="margin-bottom: 15px;">ðŸ“¥ Download for Offline Use:</label>
                <p style="color: #666; font-size: 0.9em; margin-bottom: 15px; font-weight: normal;">
                    Download a subject to practice without internet connection
                </p>
                <button onclick="downloadOfflineVersion('java')" style="background: linear-gradient(135deg, #4caf50 0%, #45a049 100%); margin-bottom: 10px;">
                    Download Java Course
                </button>
                <button onclick="downloadOfflineVersion('calculus')" style="background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);">
                    Download Calculus Course
                </button>
            </div>
        </div>

        <div id="quizSection" class="quiz-container">
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-number" id="questionsAnswered">0</div>
                    <div class="stat-label">Answered</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="questionsRemaining">100</div>
                    <div class="stat-label">Remaining</div>
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div id="quizContent"></div>
        </div>
    </div>

    <script src="questions.js"></script>
    <script>
        let currentSubject = '';
        let questionPool = [];
        let askedQuestions = [];
        let currentQuestion = null;
        let selectedAnswer = null;
        let questionLimit = 'unlimited';
        let questionsAnsweredInSession = 0;
        const STORAGE_KEY_PREFIX = 'quiz_progress_';

        function getClientId() {
            let clientId = localStorage.getItem('client_id');
            if (!clientId) {
                clientId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('client_id', clientId);
            }
            return clientId;
        }

        function loadProgress() {
            const clientId = getClientId();
            const key = STORAGE_KEY_PREFIX + currentSubject + '_' + clientId;
            const saved = localStorage.getItem(key);
            return saved ? JSON.parse(saved) : [];
        }

        function saveProgress() {
            const clientId = getClientId();
            const key = STORAGE_KEY_PREFIX + currentSubject + '_' + clientId;
            localStorage.setItem(key, JSON.stringify(askedQuestions));
        }

        function startQuiz() {
            const subject = document.getElementById('subject').value;
            const limit = document.getElementById('questionLimit').value;
            
            if (!subject) {
                alert('Please select a subject first!');
                return;
            }

            currentSubject = subject;
            questionLimit = limit;
            questionsAnsweredInSession = 0;
            questionPool = window.QUESTIONS[subject];
            askedQuestions = loadProgress();

            // If all questions have been asked, reset
            if (askedQuestions.length >= questionPool.length) {
                if (confirm('You\'ve completed all questions! Start over?')) {
                    askedQuestions = [];
                    saveProgress();
                } else {
                    return;
                }
            }

            document.getElementById('setupSection').style.display = 'none';
            document.getElementById('quizSection').style.display = 'block';
            
            updateStats();
            displayNextQuestion();
        }

        function updateStats() {
            const totalInSession = questionLimit === 'unlimited' ? questionPool.length : parseInt(questionLimit);
            const remaining = questionLimit === 'unlimited' 
                ? questionPool.length - askedQuestions.length 
                : Math.max(0, totalInSession - questionsAnsweredInSession);
            
            document.getElementById('questionsAnswered').textContent = questionsAnsweredInSession;
            document.getElementById('questionsRemaining').textContent = remaining;
            
            const progress = questionLimit === 'unlimited'
                ? (askedQuestions.length / questionPool.length) * 100
                : (questionsAnsweredInSession / totalInSession) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function displayNextQuestion() {
            // Check if we've reached the question limit
            if (questionLimit !== 'unlimited' && questionsAnsweredInSession >= parseInt(questionLimit)) {
                showSessionComplete();
                return;
            }

            // Get unasked questions
            const availableIndices = questionPool
                .map((_, index) => index)
                .filter(index => !askedQuestions.includes(index));

            if (availableIndices.length === 0) {
                showCompletion();
                return;
            }

            // Pick random unasked question
            const randomIndex = availableIndices[Math.floor(Math.random() * availableIndices.length)];
            currentQuestion = { ...questionPool[randomIndex], index: randomIndex };
            selectedAnswer = null;

            const quizContent = document.getElementById('quizContent');
            quizContent.innerHTML = `
                <div class="question-card">
                    <div class="question-text">
                        ${currentQuestion.question}
                    </div>
                    <div class="answers-grid">
                        ${currentQuestion.choices.map((choice, index) => `
                            <div class="answer-option" onclick="selectAnswer(${index})">
                                ${choice}
                            </div>
                        `).join('')}
                    </div>
                    <div id="explanation" class="explanation"></div>
                </div>
                <button class="next-button" id="nextBtn" onclick="nextQuestion()" style="display: none;">Next Question â†’</button>
            `;
        }

        function selectAnswer(index) {
            if (selectedAnswer !== null) return;

            selectedAnswer = index;
            const options = document.querySelectorAll('.answer-option');
            
            options.forEach((option, i) => {
                option.style.pointerEvents = 'none';
                if (i === currentQuestion.correct) {
                    option.classList.add('correct');
                } else if (i === selectedAnswer) {
                    option.classList.add('incorrect');
                }
            });

            if (selectedAnswer !== currentQuestion.correct) {
                const explanationDiv = document.getElementById('explanation');
                explanationDiv.innerHTML = `
                    <div class="explanation-title">ðŸ“š Explanation:</div>
                    <div class="explanation-text">${currentQuestion.explanation}</div>
                `;
                explanationDiv.style.display = 'block';
            }

            // Mark question as asked
            askedQuestions.push(currentQuestion.index);
            questionsAnsweredInSession++;
            saveProgress();
            updateStats();

            document.getElementById('nextBtn').style.display = 'block';
        }

        function nextQuestion() {
            displayNextQuestion();
        }

        function showSessionComplete() {
            const totalAsked = questionsAnsweredInSession;
            const limit = parseInt(questionLimit);
            
            document.getElementById('quizContent').innerHTML = `
                <div class="question-card" style="text-align: center;">
                    <h2 style="color: #667eea; margin-bottom: 20px;">âœ… Session Complete!</h2>
                    <p style="font-size: 1.2em; color: #666; margin-bottom: 20px;">
                        You completed ${totalAsked} questions!
                    </p>
                    <p style="font-size: 1em; color: #888; margin-bottom: 30px;">
                        ${questionPool.length - askedQuestions.length} questions remaining in this subject.
                    </p>
                    <button onclick="continueQuiz()">Continue Practicing</button>
                    <button onclick="location.reload()" style="margin-top: 10px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">Start New Session</button>
                </div>
            `;
        }

        function showCompletion() {
            document.getElementById('quizContent').innerHTML = `
                <div class="question-card" style="text-align: center;">
                    <h2 style="color: #667eea; margin-bottom: 20px;">ðŸŽ‰ All Questions Complete!</h2>
                    <p style="font-size: 1.2em; color: #666; margin-bottom: 20px;">
                        You've answered all ${questionPool.length} questions in this subject!
                    </p>
                    <button onclick="resetQuiz()">Start Over</button>
                    <button onclick="location.reload()" style="margin-top: 10px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">Choose Different Subject</button>
                </div>
            `;
        }

        function continueQuiz() {
            questionsAnsweredInSession = 0;
            updateStats();
            displayNextQuestion();
        }

        function resetQuiz() {
            askedQuestions = [];
            questionsAnsweredInSession = 0;
            saveProgress();
            updateStats();
            displayNextQuestion();
        }

        function downloadOfflineVersion(subject) {
            const subjectName = subject === 'java' ? 'Java' : 'Calculus';
            const questions = window.QUESTIONS[subject];
            
            // Create a standalone HTML file with embedded questions
            const htmlContent = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${subjectName} Quiz - Offline Version</title>
    <style>
        ${document.querySelector('style').textContent}
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŽ“ ${subjectName} Quiz</h1>
        <p class="subtitle">Offline Practice - ${questions.length} Questions</p>
        
        <div id="setupSection">
            <div class="subject-selection">
                <label for="questionLimit">Number of Questions:</label>
                <select id="questionLimit">
                    <option value="5">5 Questions (Quick Practice)</option>
                    <option value="10">10 Questions (Short Session)</option>
                    <option value="15">15 Questions (Medium Session)</option>
                    <option value="20">20 Questions (Long Session)</option>
                    <option value="unlimited">Unlimited (All Questions)</option>
                </select>
            </div>
            <button onclick="startQuiz()">Start Quiz</button>
        </div>

        <div id="quizSection" class="quiz-container">
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-number" id="questionsAnswered">0</div>
                    <div class="stat-label">Answered</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="questionsRemaining">${questions.length}</div>
                    <div class="stat-label">Remaining</div>
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div id="quizContent"></div>
        </div>
    </div>

    <script>
        const QUESTIONS = ${JSON.stringify(questions)};
        let questionPool = QUESTIONS;
        let askedQuestions = [];
        let currentQuestion = null;
        let selectedAnswer = null;
        let questionLimit = 'unlimited';
        let questionsAnsweredInSession = 0;
        const STORAGE_KEY = 'quiz_progress_${subject}_offline';

        function loadProgress() {
            const saved = localStorage.getItem(STORAGE_KEY);
            return saved ? JSON.parse(saved) : [];
        }

        function saveProgress() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(askedQuestions));
        }

        function startQuiz() {
            const limit = document.getElementById('questionLimit').value;
            questionLimit = limit;
            questionsAnsweredInSession = 0;
            askedQuestions = loadProgress();

            if (askedQuestions.length >= questionPool.length) {
                if (confirm('You\\'ve completed all questions! Start over?')) {
                    askedQuestions = [];
                    saveProgress();
                } else {
                    return;
                }
            }

            document.getElementById('setupSection').style.display = 'none';
            document.getElementById('quizSection').style.display = 'block';
            
            updateStats();
            displayNextQuestion();
        }

        function updateStats() {
            const totalInSession = questionLimit === 'unlimited' ? questionPool.length : parseInt(questionLimit);
            const remaining = questionLimit === 'unlimited' 
                ? questionPool.length - askedQuestions.length 
                : Math.max(0, totalInSession - questionsAnsweredInSession);
            
            document.getElementById('questionsAnswered').textContent = questionsAnsweredInSession;
            document.getElementById('questionsRemaining').textContent = remaining;
            
            const progress = questionLimit === 'unlimited'
                ? (askedQuestions.length / questionPool.length) * 100
                : (questionsAnsweredInSession / totalInSession) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function displayNextQuestion() {
            if (questionLimit !== 'unlimited' && questionsAnsweredInSession >= parseInt(questionLimit)) {
                showSessionComplete();
                return;
            }

            const availableIndices = questionPool
                .map((_, index) => index)
                .filter(index => !askedQuestions.includes(index));

            if (availableIndices.length === 0) {
                showCompletion();
                return;
            }

            const randomIndex = availableIndices[Math.floor(Math.random() * availableIndices.length)];
            currentQuestion = { ...questionPool[randomIndex], index: randomIndex };
            selectedAnswer = null;

            const quizContent = document.getElementById('quizContent');
            quizContent.innerHTML = \`
                <div class="question-card">
                    <div class="question-text">
                        \${currentQuestion.question}
                    </div>
                    <div class="answers-grid">
                        \${currentQuestion.choices.map((choice, index) => \`
                            <div class="answer-option" onclick="selectAnswer(\${index})">
                                \${choice}
                            </div>
                        \`).join('')}
                    </div>
                    <div id="explanation" class="explanation"></div>
                </div>
                <button class="next-button" id="nextBtn" onclick="nextQuestion()" style="display: none;">Next Question â†’</button>
            \`;
        }

        function selectAnswer(index) {
            if (selectedAnswer !== null) return;

            selectedAnswer = index;
            const options = document.querySelectorAll('.answer-option');
            
            options.forEach((option, i) => {
                option.style.pointerEvents = 'none';
                if (i === currentQuestion.correct) {
                    option.classList.add('correct');
                } else if (i === selectedAnswer) {
                    option.classList.add('incorrect');
                }
            });

            if (selectedAnswer !== currentQuestion.correct) {
                const explanationDiv = document.getElementById('explanation');
                explanationDiv.innerHTML = \`
                    <div class="explanation-title">ðŸ“š Explanation:</div>
                    <div class="explanation-text">\${currentQuestion.explanation}</div>
                \`;
                explanationDiv.style.display = 'block';
            }

            askedQuestions.push(currentQuestion.index);
            questionsAnsweredInSession++;
            saveProgress();
            updateStats();

            document.getElementById('nextBtn').style.display = 'block';
        }

        function nextQuestion() {
            displayNextQuestion();
        }

        function showSessionComplete() {
            document.getElementById('quizContent').innerHTML = \`
                <div class="question-card" style="text-align: center;">
                    <h2 style="color: #667eea; margin-bottom: 20px;">âœ… Session Complete!</h2>
                    <p style="font-size: 1.2em; color: #666; margin-bottom: 20px;">
                        You completed \${questionsAnsweredInSession} questions!
                    </p>
                    <p style="font-size: 1em; color: #888; margin-bottom: 30px;">
                        \${questionPool.length - askedQuestions.length} questions remaining.
                    </p>
                    <button onclick="continueQuiz()">Continue Practicing</button>
                    <button onclick="location.reload()" style="margin-top: 10px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">Start New Session</button>
                </div>
            \`;
        }

        function showCompletion() {
            document.getElementById('quizContent').innerHTML = \`
                <div class="question-card" style="text-align: center;">
                    <h2 style="color: #667eea; margin-bottom: 20px;">ðŸŽ‰ All Questions Complete!</h2>
                    <p style="font-size: 1.2em; color: #666; margin-bottom: 20px;">
                        You've answered all \${questionPool.length} questions!
                    </p>
                    <button onclick="resetQuiz()">Start Over</button>
                </div>
            \`;
        }

        function continueQuiz() {
            questionsAnsweredInSession = 0;
            updateStats();
            displayNextQuestion();
        }

        function resetQuiz() {
            askedQuestions = [];
            questionsAnsweredInSession = 0;
            saveProgress();
            updateStats();
            displayNextQuestion();
        }
    </script>
</body>
</html>`;

            // Create download link
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${subjectName.toLowerCase()}-quiz-offline.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            alert(`âœ… ${subjectName} quiz downloaded! Open the HTML file in any browser to practice offline.`);
        }
    </script>
</body>
</html>
